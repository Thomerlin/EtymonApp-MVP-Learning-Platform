<div>
  <hr>
  <h3>Exercises</h3>

  <!-- Login info for unauthenticated users -->
  <div *ngIf="!isAuthenticated" class="login-prompt">
    <p>Para fazer exercícios e acompanhar seu progresso, é necessário fazer login.</p>
    <button class="btn-login-prompt" (click)="authModalRequested.emit()">Entrar com Google</button>
  </div>

  <div *ngIf="allExercises.length > 0" class="exercise-wrapper">
    <ng-container [ngSwitch]="allExercises[currentExerciseIndex]?.type">
      <!-- Multiple Choice -->
      <div *ngSwitchCase="'multiple_choice'" class="exercise-card-multiple_choice"
        [class.error-animation]="showErrorAnimation" [class.slide-out]="isSlidingOut">
        <h3>{{ allExercises[currentExerciseIndex].question }}</h3>
        <div *ngFor="let option of allExercises[currentExerciseIndex].options.split(',')">
          <input type="radio" [name]="'multiple_choice_' + allExercises[currentExerciseIndex].id"
            [value]="option.split('.')[0].trim()" (change)="answer = option.split('.')[0].trim()">
          {{ option }}
        </div>
        <div class="exercise-buttons">
          <button
            (click)="validate(allExercises[currentExerciseIndex].id, answer, 'multiple_choice')">Validate</button>
        </div>
      </div>

      <!-- Fill in the Blanks -->
      <div *ngSwitchCase="'fill_in_the_blanks'" class="exercise-card-fill_in_the_blanks"
        [class.error-animation]="showErrorAnimation" [class.slide-out]="isSlidingOut">
        <h3>
          <span *ngFor="let part of allExercises[currentExerciseIndex].sentence.split('___'); let i = index">
            {{ part }}
            <input *ngIf="i < allExercises[currentExerciseIndex].sentence.split('___').length - 1" type="text"
              [(ngModel)]="answers[allExercises[currentExerciseIndex].id]" class="inlineInput" />
          </span>
        </h3>
        <div class="exercise-buttons">
          <button
            (click)="validate(allExercises[currentExerciseIndex].id, answers[allExercises[currentExerciseIndex].id], 'fill_in_the_blanks')">Validate</button>
        </div>
      </div>

      <!-- True/False -->
      <div *ngSwitchCase="'true_false'" class="exercise-card-true-false"
        [class.error-animation]="showErrorAnimation" [class.slide-out]="isSlidingOut">
        <h3>{{ allExercises[currentExerciseIndex].statement }}</h3>
        <div class="exercise-buttons">
          <button (click)="validate(allExercises[currentExerciseIndex].id, 'T', 'true_false')">True</button>
          <button (click)="validate(allExercises[currentExerciseIndex].id, 'F', 'true_false')">False</button>
        </div>
      </div>

      <!-- Writing with Audio -->
      <div *ngSwitchCase="'writing_with_audio'" class="exercise-card-writing_with_audio"
        [class.error-animation]="showErrorAnimation" [class.slide-out]="isSlidingOut">
        <h3>Listen and Write</h3>
        <div class="writing-audio-container">
          <div class="audio-buttons">
            <button class="audio-button" 
                    [class.active]="isExercisePlaying || isExercisePaused"
                    (click)="playWritingAudio(allExercises[currentExerciseIndex].id)">
              <span *ngIf="!isExercisePlaying && !isExercisePaused">▶️ Play</span>
              <span *ngIf="isExercisePlaying">⏸️ Pause</span>
              <span *ngIf="!isExercisePlaying && isExercisePaused">▶️ Resume</span>
            </button>
            <button class="audio-button"
                    (click)="stopExerciseAudio()" 
                    [disabled]="!isExercisePlaying && !isExercisePaused">
              ⏹️ Stop
            </button>
          </div>
          <textarea class="writing-textarea" [(ngModel)]="answers[allExercises[currentExerciseIndex].id]"
            placeholder="Type your answer here..."></textarea>
        </div>
        <div class="exercise-buttons">
          <button
            (click)="validate(allExercises[currentExerciseIndex].id, answers[allExercises[currentExerciseIndex].id], 'writing_with_audio')">Validate</button>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Article Progress only shown to authenticated users -->
  <div *ngIf="isAuthenticated" class="articleProgressSection">
    <app-progress-exercises [articleId]="articleId.toString()" [level]="currentLevel" [userId]="1">
    </app-progress-exercises>
  </div>

  <!-- Vocabulary Matching -->
  <div class="flashcard-container">
    <div *ngFor="let flashcard of vocabularyFlashcards" class="flashcard" [class.flipped]="flashcard.flipped"
      (click)="flipFlashcard(flashcard)">
      <div class="flashcard-front">
        <h3>{{ flashcard.word }}</h3>
      </div>
      <div class="flashcard-back">
        <p><strong>Definition:</strong> {{ flashcard.definition }}</p>
        <p><strong>Example:</strong> {{ flashcard.example }}</p>
      </div>
    </div>
  </div>
</div>
